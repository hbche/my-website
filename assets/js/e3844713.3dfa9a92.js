"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8244],{6531:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>h});var s=n(74848),a=n(28453);const r={title:"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001",description:"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001",authors:{name:"Hanbin Che",title:"Front End Engineer",url:"https://github.com/hbche",image_url:"https://github.com/hbche.png"},tags:["\u524d\u7aef","\u72b6\u6001\u7ba1\u7406","zustand","\u7ffb\u8bd1"],sidebar_position:12,last_update:{date:new Date("2025-01-16T00:00:00.000Z"),author:"hbche"}},i=void 0,o={id:"guides/connect-to-state-with-url-hash",title:"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001",description:"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001",source:"@site/tutorial/zustand/guides/connect-to-state-with-url-hash.md",sourceDirName:"guides",slug:"/guides/connect-to-state-with-url-hash",permalink:"/my-website/zustand/guides/connect-to-state-with-url-hash",draft:!1,unlisted:!1,tags:[{label:"\u524d\u7aef",permalink:"/my-website/zustand/tags/\u524d\u7aef"},{label:"\u72b6\u6001\u7ba1\u7406",permalink:"/my-website/zustand/tags/\u72b6\u6001\u7ba1\u7406"},{label:"zustand",permalink:"/my-website/zustand/tags/zustand"},{label:"\u7ffb\u8bd1",permalink:"/my-website/zustand/tags/\u7ffb\u8bd1"}],version:"current",lastUpdatedBy:"hbche",lastUpdatedAt:1736985600,formattedLastUpdatedAt:"2025\u5e741\u670816\u65e5",sidebarPosition:12,frontMatter:{title:"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001",description:"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001",authors:{name:"Hanbin Che",title:"Front End Engineer",url:"https://github.com/hbche",image_url:"https://github.com/hbche.png"},tags:["\u524d\u7aef","\u72b6\u6001\u7ba1\u7406","zustand","\u7ffb\u8bd1"],sidebar_position:12,last_update:{date:"2025-01-16T00:00:00.000Z",author:"hbche"}},sidebar:"tutorialSidebar",previous:{title:"Map \u548c Set \u7684\u4f7f\u7528",permalink:"/my-website/zustand/guides/maps-and-sets-usage"},next:{title:"\u5982\u4f55\u91cd\u7f6e\u72b6\u6001",permalink:"/my-website/zustand/guides/how-to-reset-state"}},c={},h=[{value:"\u5c06\u72b6\u6001\u4e0e URL \u54c8\u5e0c\u8fde\u63a5",id:"\u5c06\u72b6\u6001\u4e0e-url-\u54c8\u5e0c\u8fde\u63a5",level:3},{value:"\u6301\u4e45\u5316\u5e76\u8fde\u63a5\u72b6\u6001\u4e0e URL \u53c2\u6570\uff08\u793a\u4f8b\uff1aURL \u67e5\u8be2\u53c2\u6570\uff09",id:"\u6301\u4e45\u5316\u5e76\u8fde\u63a5\u72b6\u6001\u4e0e-url-\u53c2\u6570\u793a\u4f8burl-\u67e5\u8be2\u53c2\u6570",level:3}];function l(e){const t={code:"code",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h3,{id:"\u5c06\u72b6\u6001\u4e0e-url-\u54c8\u5e0c\u8fde\u63a5",children:"\u5c06\u72b6\u6001\u4e0e URL \u54c8\u5e0c\u8fde\u63a5"}),"\n",(0,s.jsx)(t.p,{children:"\u5982\u679c\u4f60\u60f3\u5c06\u5b58\u50a8\u7684\u72b6\u6001\u4e0e URL \u54c8\u5e0c\u8fde\u63a5\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u81ea\u5df1\u7684\u54c8\u5e0c\u5b58\u50a8\u3002"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import { create } from 'zustand';\nimport { StateStorage, createJSONStorage, persist } from 'zustand/middleware';\n\nconst hashStorage: StateStorage = {\n  getItem: (key: string) => {\n    const searchParams = new URLSearchParams(location.hash.slice(1));\n    const storedValue = searchParams.get(key) ?? '';\n    return JSON.parse(storedValue);\n  },\n  setItem: (key: string, newValue: string) => {\n    const searchParams = new URLSearchParams(location.hash.slice(1));\n    searchParams.set(key, JSON.stringify(newValue));\n    location.hash = searchParams.toString();\n  },\n  removeItem: (key: string) => {\n    const searchParams = new URLSearchParams(location.hash.slice(1));\n    searchParams.delete(key);\n    location.hash = searchParams.toString();\n  },\n};\n\ninterface State {\n  fishes: number;\n}\n\ninterface Action {\n  addFish: () => void;\n}\n\nexport const useBoundStore = create<State & Action>()(\n  persist(\n    (set, get) => ({\n      fishes: 0,\n      addFish: () => set({ fishes: get().fishes + 1 }),\n    }),\n    { name: 'food-storage', storage: createJSONStorage(() => hashStorage) }\n  )\n);\n"})}),"\n",(0,s.jsx)(t.h3,{id:"\u6301\u4e45\u5316\u5e76\u8fde\u63a5\u72b6\u6001\u4e0e-url-\u53c2\u6570\u793a\u4f8burl-\u67e5\u8be2\u53c2\u6570",children:"\u6301\u4e45\u5316\u5e76\u8fde\u63a5\u72b6\u6001\u4e0e URL \u53c2\u6570\uff08\u793a\u4f8b\uff1aURL \u67e5\u8be2\u53c2\u6570\uff09"}),"\n",(0,s.jsxs)(t.p,{children:["\u6709\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u6761\u4ef6\u6027\u5730\u5c06\u72b6\u6001\u8fde\u63a5\u5230 URL\u3002 \u6b64\u793a\u4f8b\u63cf\u8ff0\u4e86\u5982\u4f55\u4f7f\u7528 URL \u67e5\u8be2\u53c2\u6570\uff0c\n\u540c\u65f6\u5c06\u5176\u4e0e\u53e6\u4e00\u79cd\u6301\u4e45\u5316\u5b9e\u73b0\uff08\u5982 ",(0,s.jsx)(t.code,{children:"localstorage"}),"\uff09\u4fdd\u6301\u540c\u6b65\u3002"]}),"\n",(0,s.jsxs)(t.p,{children:["\u5982\u679c\u4f60\u5e0c\u671b URL \u53c2\u6570\u59cb\u7ec8\u586b\u5145\uff0c\u53ef\u4ee5\u5220\u9664\u5bf9 ",(0,s.jsx)(t.code,{children:"getUrlSearch()"}),"\u7684\u6761\u4ef6\u68c0\u67e5\u3002"]}),"\n",(0,s.jsx)(t.p,{children:"\u4e0b\u9762\u7684\u5b9e\u73b0\u5c06\u5728\u76f8\u5173\u72b6\u6001\u66f4\u6539\u65f6\u66f4\u65b0 URL\uff0c\u65e0\u9700\u5237\u65b0\u3002"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import { create } from 'zustand';\nimport { StateStorage, createJSONStorage, persist } from 'zustand/middleware';\n\nconst getUrlSearch = () => {\n  return window.location.search.slice(1);\n};\n\nconst persistentStorage: StateStorage = {\n  getItem: (name: string): string => {\n    if (getUrlSearch()) {\n      const searchParams = new URLSearchParams(getUrlSearch());\n      const sortedValue = searchParams.get(name);\n      return JSON.parse(sortedValue as string);\n    } else {\n      return JSON.parse(localStorage.getItem(name) as string);\n    }\n  },\n  setItem: (name: string, value: string): void => {\n    if (getUrlSearch()) {\n      const searchParams = new URLSearchParams(getUrlSearch());\n      searchParams.set(name, JSON.stringify(value));\n      window.history.replaceState({}, '', '?' + searchParams.toString());\n    }\n\n    localStorage.setItem(name, JSON.stringify(value));\n  },\n  removeItem: (name: string): void => {\n    const searchParams = new URLSearchParams(getUrlSearch());\n    searchParams.delete(name);\n    window.location.search = searchParams.toString();\n  },\n};\n\ntype LocalAndUrlStore = {\n  typesOfFish: string[];\n  addTypeOfFish: (fishType: string) => void;\n  numberOfBears: number;\n  setNumberOfBears: (newNumber: number) => void;\n};\n\nconst storageOptions = {\n  name: 'fishAndBearsStore',\n  storage: createJSONStorage<LocalAndUrlStore>(() => persistentStorage),\n};\n\nexport const useLocalAndUrlStore = create<LocalAndUrlStore>()(\n  persist(\n    (set) => ({\n      typesOfFish: [],\n      addTypeOfFish: (fishType: string) =>\n        set((state) => ({ typesOfFish: [...state.typesOfFish, fishType] })),\n      numberOfBears: 0,\n      setNumberOfBears: (newNumber: number) =>\n        set((state) => ({\n          ...state,\n          numberOfBears: newNumber,\n        })),\n    }),\n    storageOptions\n  )\n);\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u5728\u4ece\u7ec4\u4ef6\u751f\u6210 URL \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u7528 buildShareableUrl\uff1a"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"const buildURLSuffix = (params, version = 0) => {\n  const searchParams = new URLSearchParams();\n\n  const zustandStoreParams = {\n    state: {\n      typesOfFish: params.typesOfFish,\n      numberOfBears: params.numberOfBears,\n    },\n    version: version, // version is here because that is included with how Zustand sets the state\n  };\n\n  // The URL param key should match the name of the store, as specified as in storageOptions above\n  searchParams.set('fishAndBearsStore', JSON.stringify(zustandStoreParams));\n  return searchParams.toString();\n};\n\nexport const buildShareableUrl = (params, version) => {\n  return `${window.location.origin}?${buildURLSuffix(params, version)}`;\n};\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u751f\u6210\u7684 URL \u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff08\u4e3a\u4e86\u6613\u8bfb\u8fd9\u91cc\u6ca1\u6709\u4efb\u4f55\u7f16\u7801\uff09\uff1a"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'https://localhost/search?fishAndBearsStore={"state":{"typesOfFish":["tilapia","salmon"],"numberOfBears":15},"version":0}}\n'})})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var s=n(96540);const a={},r=s.createContext(a);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);