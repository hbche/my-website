"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9233],{5439:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var o=t(74848),r=t(28453);const s={title:"useStore \u269b\ufe0f",description:"\u5982\u4f55\u5728React\u4e2d\u4f7f\u7528\u539f\u59cbstore",authors:{name:"Hanbin Che",title:"Front End Engineer",url:"https://github.com/hbche",image_url:"https://github.com/hbche.png"},tags:["\u524d\u7aef","\u72b6\u6001\u7ba1\u7406","zustand","\u7ffb\u8bd1"],sidebar_position:28,last_update:{date:new Date("2025-01-17T00:00:00.000Z"),author:"hbche"}},i=void 0,c={id:"hooks/use-store",title:"useStore \u269b\ufe0f",description:"\u5982\u4f55\u5728React\u4e2d\u4f7f\u7528\u539f\u59cbstore",source:"@site/tutorial/zustand/hooks/use-store.md",sourceDirName:"hooks",slug:"/hooks/use-store",permalink:"/my-website/zustand/hooks/use-store",draft:!1,unlisted:!1,tags:[{label:"\u524d\u7aef",permalink:"/my-website/zustand/tags/\u524d\u7aef"},{label:"\u72b6\u6001\u7ba1\u7406",permalink:"/my-website/zustand/tags/\u72b6\u6001\u7ba1\u7406"},{label:"zustand",permalink:"/my-website/zustand/tags/zustand"},{label:"\u7ffb\u8bd1",permalink:"/my-website/zustand/tags/\u7ffb\u8bd1"}],version:"current",lastUpdatedBy:"hbche",lastUpdatedAt:1737072e3,formattedLastUpdatedAt:"2025\u5e741\u670817\u65e5",sidebarPosition:28,frontMatter:{title:"useStore \u269b\ufe0f",description:"\u5982\u4f55\u5728React\u4e2d\u4f7f\u7528\u539f\u59cbstore",authors:{name:"Hanbin Che",title:"Front End Engineer",url:"https://github.com/hbche",image_url:"https://github.com/hbche.png"},tags:["\u524d\u7aef","\u72b6\u6001\u7ba1\u7406","zustand","\u7ffb\u8bd1"],sidebar_position:28,last_update:{date:"2025-01-17T00:00:00.000Z",author:"hbche"}},sidebar:"tutorialSidebar",previous:{title:"useShallow \u269b\ufe0f",permalink:"/my-website/zustand/hooks/use-shallow"},next:{title:"useStoreWithEqualityFn \u269b\ufe0f",permalink:"/my-website/zustand/hooks/use-store-with-equality-fn"}},a={},l=[{value:"\u7c7b\u578b",id:"\u7c7b\u578b",level:2},{value:"\u7b7e\u540d",id:"\u7b7e\u540d",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2},{value:"<code>useStore(store, selectorFn)</code>",id:"usestorestore-selectorfn",level:3},{value:"\u53c2\u6570",id:"\u53c2\u6570",level:4},{value:"\u8fd4\u56de\u503c",id:"\u8fd4\u56de\u503c",level:4},{value:"\u7528\u6cd5",id:"\u7528\u6cd5",level:2},{value:"\u5728 React \u4e2d\u4f7f\u7528\u5168\u5c40\u539f\u59cb store",id:"\u5728-react-\u4e2d\u4f7f\u7528\u5168\u5c40\u539f\u59cb-store",level:3},{value:"\u5728 React \u4e2d\u4f7f\u7528\u52a8\u6001\u5168\u5c40\u539f\u59cb store",id:"\u5728-react-\u4e2d\u4f7f\u7528\u52a8\u6001\u5168\u5c40\u539f\u59cb-store",level:3},{value:"\u5728 React \u4f7f\u7528\u4f5c\u7528\u57df(\u975e\u5168\u5c40)\u539f\u59cb store",id:"\u5728-react-\u4f7f\u7528\u4f5c\u7528\u57df\u975e\u5168\u5c40\u539f\u59cb-store",level:3},{value:"\u5728 React \u4e2d\u4f7f\u7528\u52a8\u6001\u4f5c\u7528\u57df(\u975e\u5168\u5c40)\u539f\u59cb store",id:"\u5728-react-\u4e2d\u4f7f\u7528\u52a8\u6001\u4f5c\u7528\u57df\u975e\u5168\u5c40\u539f\u59cb-store",level:3},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"useStore"})," \u662f\u4e00\u4e2a\u8ba9\u6211\u4eec\u5728 React \u4e2d\u4f7f\u7528\u539f\u59cb Store \u7684 Hook\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const someStore = useStore(store, selectorFn);\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#%E7%B1%BB%E5%9E%8B",children:"\u7c7b\u578b"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E7%AD%BE%E5%90%8D",children:"\u7b7e\u540d"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#%E5%8F%82%E8%80%83",children:"\u53c2\u8003"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#usestorestore-selectorfn",children:(0,o.jsx)(n.code,{children:"useStore(store, selectorFn)"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E5%8F%82%E6%95%B0",children:"\u53c2\u6570"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E8%BF%94%E5%9B%9E%E5%80%BC",children:"\u8fd4\u56de\u503c"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#%E7%94%A8%E6%B3%95",children:"\u7528\u6cd5"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%85%A8%E5%B1%80%E5%8E%9F%E5%A7%8B-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u5168\u5c40\u539f\u59cb store"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E5%85%A8%E5%B1%80%E5%8E%9F%E5%A7%8B-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u52a8\u6001\u5168\u5c40\u539f\u59cb store"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E5%9C%A8-react-%E4%BD%BF%E7%94%A8%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%9D%9E%E5%85%A8%E5%B1%80%E5%8E%9F%E5%A7%8B-store",children:"\u5728 React \u4f7f\u7528\u4f5c\u7528\u57df(\u975e\u5168\u5c40)\u539f\u59cb store"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%9D%9E%E5%85%A8%E5%B1%80%E5%8E%9F%E5%A7%8B-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u52a8\u6001\u4f5c\u7528\u57df(\u975e\u5168\u5c40)\u539f\u59cb store"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4",children:"\u6545\u969c\u6392\u9664"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u7c7b\u578b",children:"\u7c7b\u578b"}),"\n",(0,o.jsx)(n.h3,{id:"\u7b7e\u540d",children:"\u7b7e\u540d"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"useStore<StoreApi<T>, U = T>(store: StoreApi<T>, selectorFn?: (state: T) => U) => UseBoundStore<StoreApi<T>>\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,o.jsx)(n.h3,{id:"usestorestore-selectorfn",children:(0,o.jsx)(n.code,{children:"useStore(store, selectorFn)"})}),"\n",(0,o.jsx)(n.h4,{id:"\u53c2\u6570",children:"\u53c2\u6570"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"storeApi"}),": \u8be5\u5b9e\u4f8b\u5141\u8bb8\u6211\u4eec\u8bbf\u95ee store \u4e0a\u7684 API"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"selectorFn"}),": \u5141\u8bb8\u6211\u4eec\u57fa\u4e8e\u5f53\u524d\u72b6\u6001\u8fd4\u56de\u6570\u636e\u7684\u51fd\u6570"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"\u8fd4\u56de\u503c",children:"\u8fd4\u56de\u503c"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"useStore"})," \u6839\u636e\u9009\u62e9\u5668\u51fd\u6570\u8fd4\u56de\u57fa\u4e8e\u5f53\u524d\u72b6\u6001\u7684\u4efb\u4f55\u6570\u636e\u3002\u9700\u8981\u5c06 store \u548c \u9009\u62e9\u5668\u51fd\u6570\n\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"]}),"\n",(0,o.jsx)(n.h2,{id:"\u7528\u6cd5",children:"\u7528\u6cd5"}),"\n",(0,o.jsx)(n.h3,{id:"\u5728-react-\u4e2d\u4f7f\u7528\u5168\u5c40\u539f\u59cb-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u5168\u5c40\u539f\u59cb store"}),"\n",(0,o.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u521b\u5efa\u4e00\u4e2a store \u5b9e\u4f8b\u6765\u5b58\u50a8\u5c4f\u5e55\u4e0a\u70b9\u7684\u5750\u6807\u3002\u6211\u4eec\u5c06\u5b9a\u4e49 store \u6765\u7ba1\u7406 ",(0,o.jsx)(n.code,{children:"x"}),"\n\u548c ",(0,o.jsx)(n.code,{children:"y"})," \u5750\u6807\u5e76\u4e14\u63d0\u4f9b\u4e00\u4e2a\u66f4\u65b0\u8fd9\u4e9b\u5750\u6807\u7684 action\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"type PositionStoreState = {\n  position: { x: number; y: number };\n};\n\ntype PositionStoreActions = {\n  setPosition: (position: PositionStoreState['position']) => void;\n};\n\ntype PositionStore = PositionStoreState & PositionStoreActions;\n\nconst positionStore = createStore<PositionStore>()((set) => ({\n  position: { x: 0, y: 0 },\n  setPosition: (position) => set({ position }),\n}));\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a ",(0,o.jsx)(n.code,{children:"MovingDot"})," \u7ec4\u4ef6\uff0c\u5b83\u5448\u73b0\u4e00\u4e2a\u8868\u793a\u70b9\u7684 div\u3002\u8fd9\u4e2a\u7ec4\u4ef6\u5c06\u4f7f\u7528\nstore \u8ddf\u8e2a\u548c\u66f4\u65b0\u70b9\u7684\u5750\u6807\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import { useStore } from 'zustand';\nimport { positionStore } from './position-store';\n\nexport function MovingDot() {\n  const position = useStore(positionStore, (state) => state.position);\n  const setPosition = useStore(positionStore, (state) => state.setPosition);\n\n  return (\n    <div\n      style={{\n        position: 'relative',\n        width: '100vw',\n        height: '100vh',\n      }}\n      onPointerMove={(e) => {\n        setPosition({\n          x: e.clientX,\n          y: e.clientY,\n        });\n      }}\n    >\n      <div\n        style={{\n          position: 'absolute',\n          transform: `translate(${position.x}px, ${position.y}px)`,\n          top: -10,\n          left: -10,\n          width: 20,\n          height: 20,\n          borderRadius: '50%',\n          backgroundColor: 'red',\n        }}\n      ></div>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u5c06\u5728 ",(0,o.jsx)(n.code,{children:"App"})," \u7ec4\u4ef6\u4e2d\u6e32\u67d3 ",(0,o.jsx)(n.code,{children:"MovingDot"})," \u7ec4\u4ef6\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"export default function App() {\n  return <MovingDot />;\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u5728-react-\u4e2d\u4f7f\u7528\u52a8\u6001\u5168\u5c40\u539f\u59cb-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u52a8\u6001\u5168\u5c40\u539f\u59cb store"}),"\n",(0,o.jsx)(n.p,{children:"\u9996\u5148\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\u751f\u6210 store \u6765\u7ba1\u7406 counter \u7684\u72b6\u6001\u3002\u6bcf\u4e00\u4e2a tab \u90fd\u6709\u5b83\u81ea\n\u5df1\u7684 store \u5b9e\u4f8b\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { createStore } from 'zustand';\n\ntype CounterState = {\n  count: number;\n};\n\ntype CounterActions = {\n  increment: () => void;\n};\n\ntype CounterStore = CounterState & CounterActions;\n\nexport const createCounterStore = () => {\n  return createStore<CounterStore>()((set) => ({\n    count: 0,\n    increment: () => {\n      set((state) => ({\n        count: state.count + 1,\n      }));\n    },\n  }));\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u65b9\u6cd5\u6765\u7ba1\u7406\u8ba1\u6570\u5668 store \u7684\u521b\u5efa\u548c\u68c0\u7d22\u3002\u8ba9\u6bcf\u4e2a\u9009\u9879\u5361\u90fd\u6709\n\u81ea\u5df1\u72ec\u7acb\u7684\u8ba1\u6570\u5668\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { createCounterStore } from './create-counter-store';\n\nconst defaultCounterStores = new Map<\n  string,\n  ReturnType<typeof createCounterStore>\n>();\n\nconst createCounterStoryFactory = (\n  counterStores: typeof defaultCounterStores\n) => {\n  return (counterStoreKey: string) => {\n    if (!defaultCounterStores.has(counterStoreKey)) {\n      counterStores.set(counterStoreKey, createCounterStore());\n    }\n\n    return defaultCounterStores.get(counterStoreKey);\n  };\n};\n\nexport const getOrCreateCounterStoreByKey =\n  createCounterStoryFactory(defaultCounterStores);\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u521b\u5efa Tabs \u7ec4\u4ef6\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u9009\u9879\u5361\u4e4b\u95f4\u5207\u6362\u5e76\u4e14\u53ef\u4ee5\u66f4\u65b0\u6bcf\u4e2a\u9009\u9879\u5361\u7684\u8ba1\u6570\n\u5668\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import { useState } from 'react';\nimport { getOrCreateCounterStoreByKey } from './create-counter-factory';\nimport { useStore } from 'zustand';\n\nexport function TabsCounter() {\n  const [currentTabIndex, setCurrentTabIndex] = useState<number>(0);\n  const counterState = useStore(\n    getOrCreateCounterStoreByKey(`tab-${currentTabIndex}`)\n  );\n\n  return (\n    <div style={{ fontFamily: 'monospace' }}>\n      <div\n        style={{\n          display: 'flex',\n          gap: '0.5rem',\n          borderBottom: '1px solid salmon',\n          paddingBottom: 4,\n        }}\n      >\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(0)}\n        >\n          Tab 1\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(1)}\n        >\n          Tab 2\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(2)}\n        >\n          Tab 3\n        </button>\n      </div>\n      <div style={{ padding: 4 }}>\n        Content of Tab {currentTabIndex + 1}\n        <br /> <br />\n        <button type='button' onClick={() => counterState.increment()}>\n          Count: {counterState.count}\n        </button>\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u5c06\u521b\u5efa ",(0,o.jsx)(n.code,{children:"App"})," \u7ec4\u4ef6\uff0c\u5b83\u5c06\u5448\u73b0\u9009\u9879\u5361\u53ca\u5176\u5404\u81ea\u7684\u8ba1\u6570\u5668\u3002\u6bcf\u4e2a\u9009\u9879\u5361\u7684\u8ba1\u6570\u5668\n\u72b6\u6001\u90fd\u662f\u72ec\u7acb\u7ba1\u7406\u7684\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"export default funciton App() {\n    return <TabsCounter />;\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u5728-react-\u4f7f\u7528\u4f5c\u7528\u57df\u975e\u5168\u5c40\u539f\u59cb-store",children:"\u5728 React \u4f7f\u7528\u4f5c\u7528\u57df(\u975e\u5168\u5c40)\u539f\u59cb store"}),"\n",(0,o.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u8bbe\u7f6e\u4e00\u4e2a store\uff0c\u5b83\u5c06\u4fdd\u5b58\u5c4f\u5e55\u4e0a\u7684\u70b9\u7684\u4f4d\u7f6e\u3002\u6211\u4eec\u5c06\u5b9a\u4e49 store \u4ee5\u7ba1\u7406\n",(0,o.jsx)(n.code,{children:"x"})," \u548c ",(0,o.jsx)(n.code,{children:"y"})," \u5750\u6807\u5e76\u63d0\u4f9b\u66f4\u65b0\u8fd9\u4e9b\u5750\u6807\u7684 action\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import { createStore } from 'zustand';\n\ntype PositionStoreState = {\n  position: { x: number; y: number };\n};\n\ntype PositionStoreActions = {\n  setPosition: (position: PositionStoreState['position']) => void;\n};\n\ntype PositionStore = PositionStoreState & PositionStoreActions;\n\nexport const createPositionStore = () => {\n  return createStore<PositionStore>()((set) => ({\n    position: { x: 0, y: 0 },\n    setPosition: (position) => set({ position }),\n  }));\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u4e0a\u4e0b\u6587\u548c\u4e00\u4e2a provider \u7ec4\u4ef6\uff0c\u4ee5\u901a\u8fc7 React \u5411\u4e0b\u4f20\u9012 store\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import React, { PropsWithChildren, useState } from 'react';\nimport { createPositionStore } from './position-store';\n\nexport const PositionStoreContext = React.createContext<ReturnType<\n  typeof createPositionStore\n> | null>(null);\n\nexport function PositionStoreProvider({ children }: PropsWithChildren) {\n  const [positionStore] = useState(createPositionStore);\n\n  return (\n    <PositionStoreContext.Provider value={positionStore}>\n      {children}\n    </PositionStoreContext.Provider>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u4e3a\u4e86\u7b80\u5316\u5bf9 store \u7684\u8bbf\u95ee\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a React \u81ea\u5b9a\u4e49\u94a9\u5b50",(0,o.jsx)(n.code,{children:"usePositionStore"}),"\u3002\u8fd9\u4e2a\n\u94a9\u5b50\u5c06\u4ece\u4e0a\u4e0b\u6587\u8bfb\u53d6\u5b58\u50a8\uff0c\u5e76\u5141\u8bb8\u6211\u4eec\u9009\u62e9\u72b6\u6001\u7684\u7279\u5b9a\u90e8\u5206\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import React from 'react';\nimport { PositionStoreContext } from './position-store-provider';\nimport { useStore } from 'zustand';\nimport { PositionStore } from './position-store';\n\nexport function usePositionStore<U>(selector: (state: PositionStore) => U) {\n  const positionStore = React.useContext(PositionStoreContext);\n\n  if (!positionStore) {\n    throw new Error(\n      'usePositionStore must be used within PositionStoreProvider'\n    );\n  }\n\n  return useStore(positionStore, selector);\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u521b\u5efa",(0,o.jsx)(n.code,{children:"MovingDot"}),"\u7ec4\u4ef6\uff0c\u5b83\u5c06\u5448\u73b0\u4e00\u4e2a\u8ddf\u968f\u9f20\u6807\u5149\u6807\u7684\u70b9\u5728\u5b83\u7684\u5bb9\u5668\u91cc\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"function MovingDot({ color }: { color: string }) {\n  const position = usePositionStore((state) => state.position);\n  const setPosition = usePositionStore((state) => state.setPosition);\n\n  return (\n    <div\n      onPointerMove={(e) => {\n        setPosition({\n          x:\n            e.clientX > e.currentTarget.clientWidth\n              ? e.clientX - e.currentTarget.clientWidth\n              : e.clientX,\n          y: e.clientY,\n        });\n      }}\n      style={{\n        position: 'relative',\n        width: '50vw',\n        height: '100vh',\n      }}\n    >\n      <div\n        style={{\n          position: 'absolute',\n          backgroundColor: color,\n          borderRadius: '50%',\n          transform: `translate(${position.x}px, ${position.y}px)`,\n          left: -10,\n          top: -10,\n          width: 20,\n          height: 20,\n        }}\n      />\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u5c06\u628a\u6240\u6709\u4e1c\u897f\u90fd\u653e\u5728 ",(0,o.jsx)(n.code,{children:"App"})," \u7ec4\u4ef6\u4e2d\uff0c\u5728\u90a3\u91cc\u6211\u4eec\u5448\u73b0\u4e24\u4e2a ",(0,o.jsx)(n.code,{children:"MovingDot"})," \u6bcf\u4e2a\u7ec4\n\u4ef6\u90fd\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u72b6\u6001\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"export default function App() {\n  return (\n    <div style={{ display: 'flex' }}>\n      <PositionStoreProvider>\n        <MovingDot color='red' />\n      </PositionStoreProvider>\n      <PositionStoreProvider>\n        <MovingDot color='blue' />\n      </PositionStoreProvider>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u5728-react-\u4e2d\u4f7f\u7528\u52a8\u6001\u4f5c\u7528\u57df\u975e\u5168\u5c40\u539f\u59cb-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u52a8\u6001\u4f5c\u7528\u57df(\u975e\u5168\u5c40)\u539f\u59cb store"}),"\n",(0,o.jsx)(n.p,{children:"\u9996\u5148\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\uff0c\u5b83\u751f\u6210\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406\u8ba1\u6570\u5668\u72b6\u6001\u7684 store\u3002\u6bcf\u4e2a\u9009\u9879\u5361\u90fd\n\u6709\u81ea\u5df1\u7684\u8fd9\u4e2a store \u7684\u5b9e\u4f8b\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { createStore } from 'zustand';\n\ntype CounterState = {\n  count: number;\n};\n\ntype CounterActions = {\n  increment: () => void;\n};\n\ntype CounterStore = CounterState & CounterActions;\n\nexport const createCounterStore = () => {\n  return createStore<CounterStore>()((set) => ({\n    count: 0,\n    increment: () => {\n      set((state) => ({\n        count: state.count + 1,\n      }));\n    },\n  }));\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\u6765\u7ba1\u7406\u8ba1\u6570\u5668 store \u7684\u521b\u5efa\u548c\u68c0\u7d22\u3002\u8fd9\u5141\u8bb8\u6bcf\u4e2a\u9009\u9879\u5361\n\u90fd\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u8ba1\u6570\u5668\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const createCounterStoreFactory = (\n  counterStores: Map<string, ReturnType<typeof createCounterStore>>\n) => {\n  return (counterStoreKey: string) => {\n    if (!counterStores.has(counterStoreKey)) {\n      counterStores.set(counterStoreKey, createCounterStore());\n    }\n    return counterStores.get(counterStoreKey)!;\n  };\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u65b9\u6cd5\u6765\u7ba1\u7406\u548c\u8bbf\u95ee\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u8fd9\u4e9b store\u3002\u6211\u4eec\u5c06\u4f7f\u7528\u4e0a\u4e0b\u6587\n\u4f20\u9012\u8fd9\u4e9b store\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import React, { PropsWithChildren, useState } from 'react';\nimport { createCounterStore } from './create-counter-store';\n\nconst CounterStoresContext = React.createContext<Map<\n  string,\n  ReturnType<typeof createCounterStore>\n> | null>(null);\n\nexport function CounterStoresProvider({ children }: PropsWithChildren) {\n  const [stores] = useState(\n    () => new Map<string, ReturnType<typeof createCounterStore>>()\n  );\n\n  return (\n    <CounterStoresContext.Provider value={stores}>\n      {children}\n    </CounterStoresContext.Provider>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u73b0\u5728\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u94a9\u5b50 ",(0,o.jsx)(n.code,{children:"useCounterStore"}),"\uff0c\u5b83\u5141\u8bb8\u6211\u4eec\u6839\u636e\u7ed9\u5b9a\u9009\u9879\u5361\u627e\u5230\u54cd\n\u5e94\u7684 store\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"export const useCounterStore = <U>(\n  name: string,\n  selector: (state: CounterStore) => U\n) => {\n  const stores = useContext(CounterStoresContext);\n\n  if (!stores) {\n    throw new Error(\n      'useCounterStore must be used within CounterStoresProvider'\n    );\n  }\n\n  const getOrCreateCounterStoreByKey = useCallback(\n    (key: string) => createCounterStoreFactory(stores)(key),\n    [stores]\n  );\n\n  return useStore(getOrCreateCounterStoreByKey(name), selector);\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u6784\u5efa Tabs \u7ec4\u4ef6\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u6bcf\u4e00\u4e2a\u9009\u9879\u5361\u4e4b\u95f4\u5207\u6362\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import { useState } from 'react';\nimport { useCounterStore } from './use-counter-store';\n\nexport function Tabs() {\n  const [currentTabIndex, setCurrentTabIndex] = useState(0);\n  const counterState = useCounterStore(\n    `tab-${currentTabIndex}`,\n    (state) => state\n  );\n\n  return (\n    <div style={{ fontFamily: 'monospace' }}>\n      <h3>Using dynamic scoped (non-global) vanilla stores in React</h3>\n      <div\n        style={{\n          display: 'flex',\n          gap: '0.5rem',\n          borderBottom: '1px solid salmon',\n          paddingBottom: 4,\n        }}\n      >\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(0)}\n        >\n          Tab 1\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(1)}\n        >\n          Tab 2\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(2)}\n        >\n          Tab 3\n        </button>\n      </div>\n      <div style={{ padding: 4 }}>\n        Content of Tab {currentTabIndex + 1}\n        <br /> <br />\n        <button type='button' onClick={() => counterState.increment()}>\n          Count: {counterState.count}\n        </button>\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a ",(0,o.jsx)(n.code,{children:"App"})," \u7ec4\u4ef6\uff0c\u5b83\u5448\u73b0\u9009\u9879\u5361\u53ca\u5176\u5404\u81ea\u7684\u8ba1\u6570\u5668\u3002\u6bcf\u4e2a\u9009\u9879\u5361\u7684\u8ba1\n\u6570\u5668\u72b6\u6001\u90fd\u662f\u72ec\u7acb\u7ba1\u7406\u7684\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"export default function App() {\n  return (\n    <CounterStoresProvider>\n      <Tabs />\n    </CounterStoresProvider>\n  );\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var o=t(96540);const r={},s=o.createContext(r);function i(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);