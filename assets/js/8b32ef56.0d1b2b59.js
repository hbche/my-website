"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8914],{24006:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var o=t(74848),r=t(28453);const s={title:"useStoreWithEqualityFn \u269b\ufe0f",description:"\u5982\u4f55\u5728React\u4e2d\u9ad8\u6548\u4f7f\u7528\u539f\u59cbstore",authors:{name:"Hanbin Che",title:"Front End Engineer",url:"https://github.com/hbche",image_url:"https://github.com/hbche.png"},tags:["\u524d\u7aef","\u72b6\u6001\u7ba1\u7406","zustand","\u7ffb\u8bd1"],sidebar_position:29,last_update:{date:new Date("2025-01-20T00:00:00.000Z"),author:"hbche"}},i=void 0,a={id:"hooks/use-store-with-equality-fn",title:"useStoreWithEqualityFn \u269b\ufe0f",description:"\u5982\u4f55\u5728React\u4e2d\u9ad8\u6548\u4f7f\u7528\u539f\u59cbstore",source:"@site/tutorial/zustand/hooks/use-store-with-equality-fn.md",sourceDirName:"hooks",slug:"/hooks/use-store-with-equality-fn",permalink:"/my-website/zustand/hooks/use-store-with-equality-fn",draft:!1,unlisted:!1,tags:[{label:"\u524d\u7aef",permalink:"/my-website/zustand/tags/\u524d\u7aef"},{label:"\u72b6\u6001\u7ba1\u7406",permalink:"/my-website/zustand/tags/\u72b6\u6001\u7ba1\u7406"},{label:"zustand",permalink:"/my-website/zustand/tags/zustand"},{label:"\u7ffb\u8bd1",permalink:"/my-website/zustand/tags/\u7ffb\u8bd1"}],version:"current",lastUpdatedBy:"hbche",lastUpdatedAt:1737331200,formattedLastUpdatedAt:"2025\u5e741\u670820\u65e5",sidebarPosition:29,frontMatter:{title:"useStoreWithEqualityFn \u269b\ufe0f",description:"\u5982\u4f55\u5728React\u4e2d\u9ad8\u6548\u4f7f\u7528\u539f\u59cbstore",authors:{name:"Hanbin Che",title:"Front End Engineer",url:"https://github.com/hbche",image_url:"https://github.com/hbche.png"},tags:["\u524d\u7aef","\u72b6\u6001\u7ba1\u7406","zustand","\u7ffb\u8bd1"],sidebar_position:29,last_update:{date:"2025-01-20T00:00:00.000Z",author:"hbche"}},sidebar:"tutorialSidebar",previous:{title:"useStore \u269b\ufe0f",permalink:"/my-website/zustand/hooks/use-store"}},l={},c=[{value:"\u7c7b\u578b",id:"\u7c7b\u578b",level:2},{value:"\u7b7e\u540d",id:"\u7b7e\u540d",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2},{value:"<code>useStoreWithEqualityFn(store, selectorFn, equalityFn)</code>",id:"usestorewithequalityfnstore-selectorfn-equalityfn",level:3},{value:"\u53c2\u6570",id:"\u53c2\u6570",level:4},{value:"\u8fd4\u56de\u503c",id:"\u8fd4\u56de\u503c",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2},{value:"\u5728 React \u4e2d\u4f7f\u7528\u5168\u5c40 vanila store",id:"\u5728-react-\u4e2d\u4f7f\u7528\u5168\u5c40-vanila-store",level:3},{value:"\u5728 React \u4e2d\u52a8\u6001\u4f7f\u7528\u5168\u5c40 vanila store",id:"\u5728-react-\u4e2d\u52a8\u6001\u4f7f\u7528\u5168\u5c40-vanila-store",level:3},{value:"\u5728 React \u4e2d\u4f7f\u7528\u5c40\u90e8 vanila store",id:"\u5728-react-\u4e2d\u4f7f\u7528\u5c40\u90e8-vanila-store",level:3},{value:"\u5728 React \u4e2d\u52a8\u6001\u4f7f\u7528\u5c40\u90e8 vanila store",id:"\u5728-react-\u4e2d\u52a8\u6001\u4f7f\u7528\u5c40\u90e8-vanila-store",level:3},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2}];function d(n){const e={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"useStoreWithRedirectityFn"}),"\u662f\u4e00\u4e2a React Hook\uff0c\u53ef\u4ee5\u8ba9\u4f60\u5728 React \u4e2d\u4f7f\u7528\u4e00\u4e2a\nvanilla store\uff0c\u5c31\u50cf ",(0,o.jsx)(e.code,{children:"useStore"}),"\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:"const someState = useStoreWithEqualityFn(store, selectorFn, equalityFn);\n"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"#%E7%B1%BB%E5%9E%8B",children:"\u7c7b\u578b"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E7%AD%BE%E5%90%8D",children:"\u7b7e\u540d"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"#%E5%8F%82%E8%80%83",children:"\u53c2\u8003"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"#usestorewithequalityfnstore-selectorfn-equalityfn",children:(0,o.jsx)(e.code,{children:"useStoreWithEqualityFn(store, selectorFn, equalityFn)"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E5%8F%82%E6%95%B0",children:"\u53c2\u6570"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E8%BF%94%E5%9B%9E%E5%80%BC",children:"\u8fd4\u56de\u503c"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"#%E4%BD%BF%E7%94%A8",children:"\u4f7f\u7528"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%85%A8%E5%B1%80-vanila-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u5168\u5c40 vanila store"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E5%9C%A8-react-%E4%B8%AD%E5%8A%A8%E6%80%81%E4%BD%BF%E7%94%A8%E5%85%A8%E5%B1%80-vanila-store",children:"\u5728 React \u4e2d\u52a8\u6001\u4f7f\u7528\u5168\u5c40 vanila store"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%B1%80%E9%83%A8-vanila-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u5c40\u90e8 vanila store"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E5%9C%A8-react-%E4%B8%AD%E5%8A%A8%E6%80%81%E4%BD%BF%E7%94%A8%E5%B1%80%E9%83%A8-vanila-store",children:"\u5728 React \u4e2d\u52a8\u6001\u4f7f\u7528\u5c40\u90e8 vanila store"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4",children:"\u6545\u969c\u6392\u9664"})}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"\u7c7b\u578b",children:"\u7c7b\u578b"}),"\n",(0,o.jsx)(e.h3,{id:"\u7b7e\u540d",children:"\u7b7e\u540d"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"useStoreWithEqualityFn<T, U = T>(store: StoreApi<T>, selectorFn: (state: T) => U, equalityFn: (a: T, b: T) => boolean): U\n"})}),"\n",(0,o.jsx)(e.h2,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,o.jsx)(e.h3,{id:"usestorewithequalityfnstore-selectorfn-equalityfn",children:(0,o.jsx)(e.code,{children:"useStoreWithEqualityFn(store, selectorFn, equalityFn)"})}),"\n",(0,o.jsx)(e.h4,{id:"\u53c2\u6570",children:"\u53c2\u6570"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"storeApi"}),": \u5141\u8bb8\u4f60\u8bbf\u95ee store API \u5b9e\u7528\u7a0b\u5e8f\u7684\u5b9e\u4f8b\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"selectorFn"}),": \u5141\u8bb8\u4f60\u57fa\u4e8e\u5f53\u524d state \u8fd4\u56de\u6570\u636e\u7684\u51fd\u6570"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"equalityFn"}),": \u5141\u8bb8\u4f60\u8df3\u8fc7\u91cd\u65b0\u6e32\u67d3\u7684\u65b9\u6cd5"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"\u8fd4\u56de\u503c",children:"\u8fd4\u56de\u503c"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"useStoreWithEqualityFn"})," \u6839\u636e\u9009\u62e9\u5668\u51fd\u6570\u8fd4\u56de\u57fa\u4e8e\u5f53\u524d\u72b6\u6001\u7684\u4efb\u4f55\u6570\u636e\u5e76\u5141\u8bb8\u4f60\u4f7f\u7528\u76f8\n\u7b49\u51fd\u6570\u8df3\u8fc7\u91cd\u65b0\u6e32\u67d3\u3002\u5b83\u9700\u8981\u4e00\u4e2a store\uff0c\u4e00\u4e2a\u9009\u62e9\u5668\u51fd\u6570\u548c\u4e00\u4e2a\u76f8\u7b49\u6027\u6bd4\u8f83\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\n\u3002"]}),"\n",(0,o.jsx)(e.h2,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,o.jsx)(e.h3,{id:"\u5728-react-\u4e2d\u4f7f\u7528\u5168\u5c40-vanila-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u5168\u5c40 vanila store"}),"\n",(0,o.jsxs)(e.p,{children:["\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u8bbe\u7f6e\u4e00\u4e2a store\uff0c\u5b83\u5c06\u4fdd\u5b58\u5c4f\u5e55\u4e0a\u7684\u70b9\u7684\u4f4d\u7f6e\u3002\u6211\u4eec\u5c06\u5b9a\u4e49 store \u6765\u7ba1\n\u7406",(0,o.jsx)(e.code,{children:"x"}),"\u548c",(0,o.jsx)(e.code,{children:"y"}),"\u5750\u6807\u5e76\u63d0\u4f9b\u66f4\u65b0\u8fd9\u4e9b\u5750\u6807\u52a8\u4f5c\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"type PositionStoreState = {\n  position: {\n    x: number;\n    y: number;\n  };\n};\n\ntype PositionStoreActions = {\n  setPosition: (position: PositionStoreState['position']) => void;\n};\n\ntype PositionStore = PositionStoreState & PositionStoreActions;\n\nexport const positionStore = createStore<PositionStore>()((set) => ({\n  position: { x: 0, y: 0 },\n  setPosition: (position) => set({ position }),\n}));\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a ",(0,o.jsx)(e.code,{children:"MovingDot"})," \u7ec4\u4ef6\uff0c\u5b83\u5448\u73b0\u4e00\u4e2a\u8868\u793a\u70b9\u7684 div\u3002\u6b64\u7ec4\u4ef6\u5c06\u4f7f\u7528\nstore \u6765\u8ddf\u8e2a\u548c\u66f4\u65b0\u70b9\u7684\u4f4d\u7f6e\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"export function MovingDot() {\n  const position = useStoreWithEqualityFn(\n    positionStore,\n    (state) => state.position,\n    shallow\n  );\n  const setPosition = useStoreWithEqualityFn(\n    positionStore,\n    (state) => state.setPosition,\n    shallow\n  );\n\n  return (\n    <div>\n      <h2>Moving dot with global store</h2>\n      <div\n        onPointerMove={(e) => {\n          setPosition({\n            x: e.clientX,\n            y: e.clientY,\n          });\n        }}\n        style={{\n          position: 'relative',\n          width: '100vw',\n          height: '100vh',\n        }}\n      >\n        <div\n          style={{\n            position: 'absolute',\n            backgroundColor: 'red',\n            borderRadius: '50%',\n            transform: `translate(${position.x}px, ${position.y}px)`,\n            left: -10,\n            top: -10,\n            width: 20,\n            height: 20,\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u5728 ",(0,o.jsx)(e.code,{children:"App"})," \u7ec4\u4ef6\u4e2d\u6e32\u67d3 ",(0,o.jsx)(e.code,{children:"MovingDot"})," \u7ec4\u4ef6\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"export function App() {\n  return <MovingDot />;\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u5728-react-\u4e2d\u52a8\u6001\u4f7f\u7528\u5168\u5c40-vanila-store",children:"\u5728 React \u4e2d\u52a8\u6001\u4f7f\u7528\u5168\u5c40 vanila store"}),"\n",(0,o.jsxs)(e.p,{children:["\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u8bbe\u7f6e\u4e00\u4e2a store\uff0c\u5b83\u5c06\u4fdd\u5b58\u5c4f\u5e55\u4e0a\u7684\u70b9\u7684\u4f4d\u7f6e\u3002\u6211\u4eec\u5c06\u5b9a\u4e49 store \u6765\u7ba1\n\u7406",(0,o.jsx)(e.code,{children:"x"}),"\u548c",(0,o.jsx)(e.code,{children:"y"}),"\u5750\u6807\u5e76\u63d0\u4f9b\u66f4\u65b0\u8fd9\u4e9b\u5750\u6807\u52a8\u4f5c\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { createStore } from 'zustand';\n\ntype CounterState = {\n  count: number;\n};\n\ntype CounterActions = {\n  increment: () => void;\n};\n\ntype CounterStore = CounterState & CounterActions;\n\nexport const createCOunterStore = () => {\n  return createStore<CounterStore>()((set) => ({\n    count: 0,\n    increment: () => {\n      set((state) => ({ count: state.count + 1 }));\n    },\n  }));\n};\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\u6765\u7ba1\u7406\u8ba1\u6570\u5668 store \u7684\u521b\u5efa\u548c\u68c0\u7d22\u3002\u8fd9\u5141\u8bb8\u6bcf\u4e2a\u9009\u9879\u5361\n\u90fd\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u8ba1\u6570\u5668\u3002"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { createCounterStore } from './create-counter-store';\n\nconst defaultCounterStores = new Map<\n  string,\n  ReturnType<typeof createCounterStore>\n>();\n\nconst createCounterStoreFactory = (\n  counterStores: typeof defaultCounterStores\n) => {\n  return (counterStoreKey: string) => {\n    if (!counterStores.get(counterStoreKey)) {\n      counterStores.set(counterStoreKey, createCounterStore());\n    }\n    return counterStores.get(counterStoreKey);\n  };\n};\n\nexport const getOrCreateCounterStoreByKey =\n  createCounterStoreFactory(defaultCounterStores);\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u6784\u5efa Tabs \u7ec4\u4ef6\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u5176\u4e2d\u5207\u6362\u9009\u9879\u5361\u5e76\u9012\u589e\u6bcf\u4e2a\u9009\u9879\u5361\u7684\u8ba1\u6570\u3002"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"export function TabsCount() {\n  const [currentTabIndex, setCurrentTabIndex] = useState(0);\n  const counterState = useStoreWithEqualityFn(\n    getOrCreateCounterStoreByKey(`tab-${currentTabIndex}`),\n    (state) => state,\n    shallow\n  );\n\n  return (\n    <div style={{ fontFamily: 'monospace' }}>\n      <div\n        style={{\n          display: 'flex',\n          gap: '0.5rem',\n          borderBottom: '1px solid salmon',\n          paddingBottom: 4,\n        }}\n      >\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(0)}\n        >\n          Tab 1\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(1)}\n        >\n          Tab 2\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(2)}\n        >\n          Tab 3\n        </button>\n      </div>\n      <div style={{ padding: 4 }}>\n        Content of Tab {currentTabIndex + 1}\n        <br /> <br />\n        <button type='button' onClick={() => counterState.increment()}>\n          Count: {counterState.count}\n        </button>\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u5c06\u521b\u5efa",(0,o.jsx)(e.code,{children:"App"}),"\u7ec4\u4ef6\uff0c\u5b83\u5448\u73b0\u9009\u9879\u5361\u53ca\u5176\u5404\u81ea\u7684\u8ba1\u6570\u5668\u3002\u6bcf\u4e2a\u9009\u9879\u5361\u7684\u8ba1\u6570\u5668\u72b6\u6001\n\u90fd\u662f\u72ec\u7acb\u7ba1\u7406\u7684\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"export default function App() {\n  return <Tabs />;\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u5728-react-\u4e2d\u4f7f\u7528\u5c40\u90e8-vanila-store",children:"\u5728 React \u4e2d\u4f7f\u7528\u5c40\u90e8 vanila store"}),"\n",(0,o.jsxs)(e.p,{children:["\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u8bbe\u7f6e\u4e00\u4e2a store\uff0c\u5b83\u5c06\u4fdd\u5b58\u5c4f\u5e55\u4e0a\u7684\u70b9\u7684\u4f4d\u7f6e\u3002\u6211\u4eec\u5c06\u5b9a\u4e49 store \u4ee5\u7ba1\u7406\n",(0,o.jsx)(e.code,{children:"x"})," \u548c ",(0,o.jsx)(e.code,{children:"y"})," \u5750\u6807\u5e76\u63d0\u4f9b\u66f4\u65b0\u8fd9\u4e9b\u5750\u6807\u52a8\u4f5c\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"type PositionStoreState = { position: { x: number; y: number } };\n\ntype PositionStoreActions = {\n  setPosition: (nextPosition: PositionStoreState['position']) => void;\n};\n\ntype PositionStore = PositionStoreState & PositionStoreActions;\n\nconst createPositionStore = () => {\n  return createStore<PositionStore>()((set) => ({\n    position: { x: 0, y: 0 },\n    setPosition: (position) => set({ position }),\n  }));\n};\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u4e0a\u4e0b\u6587\u548c\u4e00\u4e2a\u63d0\u4f9b\u7a0b\u5e8f\u7ec4\u4ef6\uff0c\u4ee5\u901a\u8fc7 React \u5411\u4e0b\u4f20\u9012 store\u3002\u7ec4\n\u4ef6\u6811\u8fd9\u5141\u8bb8\u6bcf\u4e2a ",(0,o.jsx)(e.code,{children:"MovingDot"})," \u7ec4\u4ef6\u5177\u6709\u5176\u81ea\u5df1\u7684\u72ec\u7acb\u72b6\u6001\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const PositionStoreContext = React.createContext<ReturnType<\n  typeof createPositionStore\n> | null>(null);\n\nexport function PositionStoreProvider({ children }: PropsWithChildren) {\n  const [positionStore] = useState(createPositionStore);\n\n  return (\n    <PositionStoreContext.Provider value={positionStore}>\n      {children}\n    </PositionStoreContext.Provider>\n  );\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u4e3a\u4e86\u7b80\u5316\u5bf9 store \u7684\u8bbf\u95ee\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a React \u81ea\u5b9a\u4e49\u6302\u94a9 ",(0,o.jsx)(e.code,{children:"usePositionStore"}),"\u3002\u8fd9\n\u4e2a\u94a9\u5b50\u5c06\u4ece\u4e0a\u4e0b\u6587\u8bfb\u53d6 store\uff0c\u5e76\u5141\u8bb8\u6211\u4eec\u9009\u62e9\u72b6\u6001\u7684\u7279\u5b9a\u90e8\u5206\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"export const usePositionSore = <U>(selector: (state: PositionStore) => U) => {\n  const positionStore = useContext(PositionStoreContext);\n\n  if (!positionStore) {\n    throw new Error(\n      'usePositionStore must be used within PositionStoreProvider'\n    );\n  }\n\n  return useStoreWithEqualityFn(positionStore, selector, shallow);\n};\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u521b\u5efa ",(0,o.jsx)(e.code,{children:"MovingDot"})," \u7ec4\u4ef6\uff0c\u5b83\u5c06\u5448\u73b0\u4e00\u4e2a\u8ddf\u968f\u9f20\u6807\u5149\u6807\u7684\u70b9\u5728\u5b83\u7684\u5bb9\u5668\u91cc\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function MovingDot({ color }: { color: string }) {\n  const position = usePositionStore((state) => state.position);\n  const setPosition = usePositionStore((state) => state.setPosition);\n\n  return (\n    <div\n      onPointerMove={(e) => {\n        setPosition({\n          x:\n            e.clientX > e.currentTarget.clientWidth\n              ? e.clientX - e.currentTarget.clientWidth\n              : e.clientX,\n          y: e.clientY,\n        });\n      }}\n      style={{\n        position: 'relative',\n        width: '50vw',\n        height: '100vh',\n      }}\n    >\n      <div\n        style={{\n          position: 'absolute',\n          backgroundColor: color,\n          borderRadius: '50%',\n          transform: `translate(${position.x}px, ${position.y}px)`,\n          left: -10,\n          top: -10,\n          width: 20,\n          height: 20,\n        }}\n      />\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u5c06\u628a\u6240\u6709\u4e1c\u897f\u90fd\u653e\u5728 ",(0,o.jsx)(e.code,{children:"App"})," \u7ec4\u4ef6\u4e2d\uff0c\u5728\u90a3\u91cc\u6211\u4eec\u5448\u73b0\u4e24\u4e2a ",(0,o.jsx)(e.code,{children:"MovingDot"})," \u6bcf\u4e2a\u7ec4\n\u4ef6\u90fd\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u72b6\u6001\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"export default function App() {\n  return (\n    <div style={{ display: 'flex' }}>\n      <PositionStoreProvider>\n        <MovingDot color='red' />\n      </PositionStoreProvider>\n      <PositionStoreProvider>\n        <MovingDot color='blue' />\n      </PositionStoreProvider>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u5728-react-\u4e2d\u52a8\u6001\u4f7f\u7528\u5c40\u90e8-vanila-store",children:"\u5728 React \u4e2d\u52a8\u6001\u4f7f\u7528\u5c40\u90e8 vanila store"}),"\n",(0,o.jsx)(e.p,{children:"\u9996\u5148\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\uff0c\u5b83\u751f\u6210\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406\u8ba1\u6570\u5668\u72b6\u6001\u7684 store\u3002\u6bcf\u4e2a\u9009\u9879\u5361\u90fd\n\u6709\u81ea\u5df1\u7684\u8fd9\u4e2a\u5546\u5e97\u7684\u5b9e\u4f8b\u3002"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"import { createStore } from 'zustand';\n\ntype CounterState = {\n  count: number;\n};\n\ntype CounterActions = {\n  increment: () => void;\n};\n\ntype CounterStore = CounterState & CounterActions;\n\nexport const createCounterStore = () => {\n  return createStore<CounterStore>()((set) => ({\n    count: 0,\n    increment: () => {\n      set((state) => ({ count: state.count + 1 }));\n    },\n  }));\n};\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\u6765\u7ba1\u7406\u8ba1\u6570\u5668 store \u7684\u521b\u5efa\u548c\u68c0\u7d22\u3002\u8fd9\u5141\u8bb8\u6bcf\u4e2a\u9009\u9879\u5361\n\u90fd\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u8ba1\u6570\u5668\u3002"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"export const createCounterStoreFactory = (\n  counterStores: Map<string, ReturnType<typeof createCounterStore>>\n) => {\n  return (counterStoreKey: string) => {\n    if (!counterStores.get(counterStoreKey)) {\n      counterStores.set(counterStoreKey, createCounterStore());\n    }\n\n    return counterStores.get(counterStoreKey)!;\n  };\n};\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u5728\u6574\u4e2a\u5e94\u7528\u4e2d\u7ba1\u7406\u548c\u8bbf\u95ee\u8fd9\u4e9b store \u7684\u65b9\u6cd5\u3002"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"export const CounterStoreContext = React.createContext<Map<\n  string,\n  ReturnType<typeof createCounterStore>\n> | null>(null);\n\nexport function CounterStoreProvider({ children }: PropsWithChildren) {\n  const [counterStores] = useState(\n    () => new Map<string, ReturnType<typeof createCounterStore>>()\n  );\n\n  return (\n    <CounterStoreContext.Provider value={counterStores}>\n      {children}\n    </CounterStoreContext.Provider>\n  );\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u73b0\u5728\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u94a9\u5b50 ",(0,o.jsx)(e.code,{children:"useCounterStore"})," \uff0c\u5b83\u5141\u8bb8\u6211\u4eec\u8bbf\u95ee\u7ed9\u5b9a\u9009\u9879\u5361\u7684\nstore\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"export function useCounterStore<U>(\n  storeKey: string,\n  selector: (state: CounterStore) => U\n) {\n  const stores = useContext(CounterStoreContext);\n\n  if (stores === undefined) {\n    throw new Error(\n      'useCounterStore must be used within CounterStoresProvider'\n    );\n  }\n\n  const getOrCreateCounterStoreByKey = useCallback(\n    (storeKey: string) => createCounterStoreFactory(stores!)(storeKey),\n    [stores]\n  );\n\n  return useStoreWithEqualityFn(\n    getOrCreateCounterStoreByKey(storeKey),\n    selector,\n    shallow\n  );\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u6784\u5efa ",(0,o.jsx)(e.code,{children:"Tabs"})," \u7ec4\u4ef6\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u5176\u4e2d\u5207\u6362\u9009\u9879\u5361\u5e76\u9012\u589e\u6bcf\u4e2a\u9009\u9879\u5361\u7684\u8ba1\u6570\u5668\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function Tabs() {\n  const [currentTabIndex, setCurrentTabIndex] = useState(0);\n  const counterState = useCounterStore(\n    `tab-${currentTabIndex}`,\n    (state) => state\n  );\n\n  return (\n    <div style={{ fontFamily: 'monospace' }}>\n      <div\n        style={{\n          display: 'flex',\n          gap: '0.5rem',\n          borderBottom: '1px solid salmon',\n          paddingBottom: 4,\n        }}\n      >\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(0)}\n        >\n          Tab 1\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(1)}\n        >\n          Tab 2\n        </button>\n        <button\n          type='button'\n          style={{\n            border: '1px solid salmon',\n            backgroundColor: '#fff',\n            cursor: 'pointer',\n          }}\n          onClick={() => setCurrentTabIndex(2)}\n        >\n          Tab 3\n        </button>\n      </div>\n      <div style={{ padding: 4 }}>\n        Content of Tab {currentTabIndex + 1}\n        <br /> <br />\n        <button type='button' onClick={() => counterState.increment()}>\n          Count: {counterState.count}\n        </button>\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u5c06\u521b\u5efa ",(0,o.jsx)(e.code,{children:"App"})," \u7ec4\u4ef6\uff0c\u5b83\u5448\u73b0\u9009\u9879\u5361\u53ca\u5176\u5404\u81ea\u7684\u8ba1\u6570\u5668\u3002\u6bcf\u4e2a\u9009\u9879\u5361\u7684\u8ba1\u6570\u5668\u72b6\n\u6001\u90fd\u662f\u72ec\u7acb\u7ba1\u7406\u7684\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"export default function App() {\n  return (\n    <CounterStoresProvider>\n      <Tabs />\n    </CounterStoresProvider>\n  );\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>a});var o=t(96540);const r={},s=o.createContext(r);function i(n){const e=o.useContext(s);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),o.createElement(s.Provider,{value:e},n.children)}}}]);